const penIcon = "M15.9433544,0.361322949 L19.6345068,4.01035922 C20.1218311,4.49212315 20.1218311,5.27987228 19.6345068,5.76163621 L17.593013,7.77983647 L12.1303709,2.3795232 L14.1718647,0.361322949 C14.659189,-0.120440983 15.4560301,-0.120440983 15.9433544,0.361322949 L15.9433544,0.361322949 Z M11.5541429,8.49434446 L11.5541429,8.49434446 L11.5541429,8.49597204 C11.7056085,8.64570948 11.7813414,8.84427434 11.7813414,9.03958405 C11.7813414,9.23489375 11.7056085,9.43183103 11.5541429,9.58319605 L11.5541429,9.58482363 L11.5524965,9.58645121 L6.60022782,14.483842 L6.60022782,14.483842 L6.59858146,14.483842 C6.55577594,14.5261591 6.50803133,14.5619659 6.46028672,14.5928899 L6.45864035,14.5928899 C6.40924938,14.6238139 6.35821203,14.6482277 6.30552832,14.666131 C6.03223158,14.7605307 5.71448296,14.6986827 5.49716266,14.483842 L5.49551629,14.483842 L5.49551629,14.483842 L5.49551629,14.4822144 C5.45271078,14.4398973 5.41649073,14.3926975 5.38520978,14.3454976 L5.38520978,14.34387 C5.35392883,14.2950426 5.32923334,14.2445876 5.31112331,14.192505 C5.21563409,13.9223266 5.27819599,13.6082035 5.49386993,13.3933628 L5.49386993,13.3917352 L10.447785,8.49434446 L10.447785,8.49434446 L10.4494313,8.49434446 C10.600897,8.34460702 10.8017536,8.2697383 10.9993175,8.2697383 C11.1968815,8.2697383 11.3960917,8.34460702 11.5492038,8.49434446 L11.5541429,8.49434446 L11.5541429,8.49434446 L11.5541429,8.49434446 Z M7.48761905,17.7585347 C6.00918246,18.2110021 4.53239223,18.661842 3.05395564,19.1143095 C-0.419876436,20.1771198 -0.405059143,20.8851175 0.543247624,17.5778732 L2.03650151,12.3696145 L2.03650151,12.3696145 L2.03156241,12.3647317 L11.0964531,3.40164398 L16.5590952,8.80195724 L7.49255815,17.765045 L7.48761905,17.7585347 L7.48761905,17.7585347 Z M2.96834462,13.2908252 L6.55577594,16.8373239 C5.58442005,17.1335436 4.61306416,17.4297633 3.64335464,17.7243555 C1.36149148,18.4193325 1.37136968,18.8848206 1.99204963,16.7120002 L2.96834462,13.2908252 L2.96834462,13.2908252 Z"
const closeIcon = "M10.0000814,0 C12.7605205,0 15.261843,1.1201263 17.0725673,2.92743268 C18.8798737,4.73815705 20,7.23964225 20,9.99991862 C20,12.7605205 18.8797109,15.2616802 17.0725673,17.0724046 C15.2620057,18.8800365 12.7605205,20 10.0000814,20 C7.23964225,20 4.73815705,18.8800365 2.92743268,17.0725673 C1.1201263,15.261843 0,12.7605205 0,9.99991862 C0,7.23964225 1.1201263,4.73815705 2.92743268,2.92743268 C4.73831981,1.1201263 7.23964225,0 10.0000814,0 L10.0000814,0 Z M11.9551754,6.37244769 C12.4027702,5.91801691 13.1304779,5.91590101 13.5805142,6.36821589 C14.0303876,6.82004248 14.032178,7.5550745 13.5849087,8.00934252 L11.6211883,10.0008952 L13.5868619,11.9947265 C14.0308759,12.4455765 14.0245282,13.1757257 13.5736782,13.6257619 C13.1225026,14.0759609 12.3970735,14.0746588 11.9535478,13.6238088 L10.0008952,11.6441377 L8.04498735,13.6278778 C7.59739256,14.0824714 6.86984757,14.0844245 6.41981136,13.6319469 C5.97010067,13.180283 5.96798477,12.445251 6.41557955,11.990983 L8.37897444,9.99926757 L6.41313813,8.00543624 C5.96944962,7.55474898 5.97547181,6.82443705 6.42648459,6.37423807 C6.87766014,5.92420186 7.60308922,5.92534119 8.04661496,6.37635397 L9.99926757,8.35618779 L11.9551754,6.37244769 L11.9551754,6.37244769 Z M15.77145,4.22855004 C14.2947127,2.75181276 12.2543315,1.83855663 10.0000814,1.83855663 C7.7456685,1.83855663 5.70528732,2.75181276 4.22855004,4.2287128 C2.75181276,5.70545008 1.83855663,7.74583126 1.83855663,10.0000814 C1.83855663,12.2543315 2.75181276,14.2948754 4.22855004,15.77145 C5.70528732,17.24835 7.7456685,18.1617689 10.0000814,18.1617689 C12.2543315,18.1617689 14.2947127,17.2485128 15.77145,15.77145 C17.2481872,14.2948754 18.1614434,12.2543315 18.1614434,10.0000814 C18.1614434,7.74583126 17.24835,5.70545008 15.77145,4.22855004 L15.77145,4.22855004 Z"
var showPen = true
var tmpdisplay = "block"
function findDraftEditorRoot(element) {
    if (!element) {
        return null;
    }
    if (element.classList.contains('DraftEditor-root')) {
        return element;
    }
    return findDraftEditorRoot(element.parentNode);
}

function insertIcon() {
    var firstTimeClick = true;
    var toolbarDiv = document.querySelector('div[data-testid="toolBar"]');
    var editorIcon = document.createElement('div');
    editorIcon.className = 'close-button ql-formats editIcon';
    // editorIcon.textContent = '';

    var svg = document.createElementNS("http://www.w3.org/2000/svg", "svg");
    svg.setAttribute("viewBox", "0 0 20 20");
    svg.setAttribute("width", "20");
    svg.setAttribute("height", "20");
    var path = document.createElementNS("http://www.w3.org/2000/svg", "path");
    path.setAttribute("d", penIcon);
    path.setAttribute("fill", "rgb(29, 155, 240)");
    svg.appendChild(path);
    editorIcon.appendChild(svg);
    editorIcon.style.position = 'inline-block';
    var firstChild = toolbarDiv.firstElementChild;
    toolbarDiv.insertBefore(editorIcon, firstChild);
    editorIcon.addEventListener('click', function () {
        if (firstTimeClick) {
            initQuillEditor();
            firstTimeClick = false;
        }
        else {
            firstTimeClick = false;
        }
        if (showPen) { showQuillEditor(path); }
        else {
            hideQuillEditor(path);
        }
        showPen = !showPen;
    });
}
function showQuillEditor(path) {
    var textarea = document.querySelector('div.DraftEditor-root');
    var draftEditorRoot = textarea
    var toolbar = document.querySelector('.ql-toolbar');
    var editorContainer = document.querySelector('#quill-editor');
    if (editorContainer) {
        editorContainer.style.display = 'block';
    }
    if (toolbar) {
        toolbar.style.display = 'block';
    }
    if (draftEditorRoot) {
        tmpdisplay = draftEditorRoot.style.display;
        draftEditorRoot.style.display = 'none';
    }
    path.setAttribute("d", closeIcon)
}
function hideQuillEditor(path) {
    var textarea = document.querySelector('div.DraftEditor-root');
    var editorContainer = document.querySelector('#quill-editor');
    var draftEditorRoot = textarea
    var toolbar = document.querySelector('.ql-toolbar');
    if (editorContainer) {
        editorContainer.style.display = 'none';
    }
    if (toolbar) {
        toolbar.style.display = 'none'
    }

    if (draftEditorRoot) {
        draftEditorRoot.style.display = "block";
    }

    path.setAttribute("d", penIcon)
}
function initQuillEditor() {
    var textarea = document.querySelector('div.DraftEditor-root');
    var editorContainer = document.createElement('div');
    editorContainer.id = 'quill-editor';
    var draftEditorRoot = textarea
    tmpdisplay = draftEditorRoot.style.display
    if (draftEditorRoot) {
        draftEditorRoot.style.display = 'none';
    }
    draftEditorRoot.parentNode.insertBefore(editorContainer, draftEditorRoot.parentNode.nextSibling);

    var quill = new Quill('#quill-editor', {
        modules: {
            toolbar: [
                [{ 'header': [1, 2, 3, 4, false] }],
                [{ 'color': [] }, { 'background': [] }],
                ['bold', 'italic', 'underline', 'strike', 'blockquote'],
                [{ 'align': [] }],
                [{ 'size': ['small', 'large', 'huge'] }],  // Font size options
                [{ 'list': 'ordered' }, { 'list': 'bullet' }, { 'indent': '-1' }, { 'indent': '+1' }],
                ['link', 'image']
            ]
        },
        theme: 'snow'
    });

    var toolbar = document.querySelector('.ql-toolbar');
    toolbar.addEventListener('click', function (event) {
        // event.stopPropagation();
    });
    textarea.style.display = 'none';
    textarea.addEventListener('input', function (event) {
        // event.stopPropagation();
    });
    var uploadButton = document.createElement('div');
    uploadButton.className = 'upload-button ql-formats';
    uploadButton.textContent = 'â†‘';
    uploadButton.style.position = 'inline-block';
    toolbar.appendChild(uploadButton);
    uploadButton.addEventListener('click', function () {
        let htmlContent = quill.root.innerHTML;
        alert(html)

    });
}


function checkForToolbarDiv() {
    var toolbarDiv = document.querySelector('div[data-testid="toolBar"]');
    if (toolbarDiv) {
        insertIcon()
    } else {
        setTimeout(checkForToolbarDiv, 100);
    }
}
checkForToolbarDiv();




